<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>YÃ¶netici Paneli - Hatay ODTÃœ MD</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root { --admin-dark: #1a252f; --admin-red: #c0392b; --gray: #f4f6f9; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--gray); display: flex; height: 100vh; overflow: hidden; }
    
    .sidebar { width: 260px; background: var(--admin-dark); color: white; display: flex; flex-direction: column; padding: 20px; }
    .sidebar h3 { text-align: center; border-bottom: 1px solid #34495e; padding-bottom: 20px; margin-bottom: 20px; }
    .menu-item { display: flex; align-items: center; gap: 10px; padding: 15px; color: #bdc3c7; text-decoration: none; border-radius: 6px; margin-bottom: 5px; cursor: pointer; transition: 0.3s; }
    .menu-item:hover, .menu-item.active { background: #2c3e50; color: white; border-left: 4px solid var(--admin-red); }
    
    .content { flex: 1; padding: 40px; overflow-y: auto; }
    .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
    
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f8f9fa; color: #555; }
    
    .form-group { margin-bottom: 15px; }
    .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; }
    .btn-green { background: #27ae60; } .btn-red { background: #c0392b; } .btn-dark { background: #2c3e50; width: 100%; }
    
    .tab-section { display: none; } .active-section { display: block; }
</style>
</head>
<body>

    <div class="sidebar">
        <h3>YÃ–NETÄ°CÄ°</h3>
        <div class="menu-item active" onclick="switchTab('members', this)"><i class="fa-solid fa-users"></i> Ãœye OnaylarÄ±</div>
        <div class="menu-item" onclick="switchTab('announcements', this)"><i class="fa-solid fa-bullhorn"></i> Duyurular</div>
        <div class="menu-item" onclick="switchTab('events', this)"><i class="fa-solid fa-calendar-days"></i> Etkinlikler</div>
        <div style="flex:1"></div>
        <a href="dashboard.html" class="menu-item"><i class="fa-solid fa-arrow-left"></i> Siteye DÃ¶n</a>
    </div>

    <div class="content">
        <div id="members" class="tab-section active-section">
            <h2>ðŸ‘¥ Onay Bekleyenler</h2>
            <div class="card"><table id="usersTable"><thead><tr><th>Ä°sim</th><th>Email</th><th>BÃ¶lÃ¼m</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="usersBody"></tbody></table></div>
        </div>

        <div id="announcements" class="tab-section">
            <h2>ðŸ“¢ Duyurular</h2>
            <div class="card" style="border-left: 5px solid #f39c12;">
                <input type="text" id="annText" class="form-control" placeholder="Duyuru metni...">
                <select id="annColor" class="form-control" style="margin-top:10px;">
                    <option value="#333">âš« Siyah</option><option value="#e74c3c">ðŸ”´ KÄ±rmÄ±zÄ±</option><option value="#27ae60">ðŸŸ¢ YeÅŸil</option><option value="#3498db">ðŸ”µ Mavi</option>
                </select>
                <button class="btn btn-dark" style="margin-top:10px;" onclick="addAnnouncement()">YayÄ±nla</button>
            </div>
            <div class="card"><table id="annTable"><tbody id="annBody"></tbody></table></div>
        </div>

        <div id="events" class="tab-section">
            <h2>ðŸ“… Etkinlik YÃ¶netimi</h2>
            <div class="card" style="border-left: 5px solid #e74c3c;">
                <h3>Yeni Etkinlik</h3>
                <div class="form-group"><input type="text" id="evtTitle" class="form-control" placeholder="Etkinlik AdÄ± (Ã–rn: ViÅŸnelik BuluÅŸmasÄ±)"></div>
                <div class="form-group"><input type="text" id="evtLoc" class="form-control" placeholder="Konum (Ã–rn: ODTÃœ MD)"></div>
                <div class="form-group" style="display:flex; gap:10px;">
                    <input type="date" id="evtDate" class="form-control">
                    <input type="time" id="evtTime" class="form-control">
                </div>
                <div class="form-group"><input type="text" id="evtSpeaker" class="form-control" placeholder="KonuÅŸmacÄ± (Opsiyonel)"></div>
                <button class="btn btn-dark" onclick="addEvent()">EtkinliÄŸi OluÅŸtur</button>
            </div>
            <h3>YaklaÅŸan Etkinlikler</h3>
            <div class="card"><table id="evtTable"><tbody id="evtBody"></tbody></table></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://hftrmiiacxgtkarsvupn.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmdHJtaWlhY3hndGthcnN2dXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODUzNzIsImV4cCI6MjA4MDM2MTM3Mn0.BgCk5xuZx6AZuxzfBHcQqg8j8BtxU9FbupDgoFecG_k';
        let supabase; try { supabase = window.supabase.createClient(supabaseUrl, supabaseKey); } catch(e){}

        document.addEventListener("DOMContentLoaded", async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if(!session) { window.location.href='index.html'; return; }
            
            // Admin KontrolÃ¼
            const { data: profile } = await supabase.from('profiles').select('role').eq('id', session.user.id).single();
            if(profile.role !== 'admin') { alert("Yetkisiz!"); window.location.href='dashboard.html'; return; }

            loadPendingUsers();
            loadAnnouncements();
            loadEvents();
        });

        function switchTab(id, el) {
            document.querySelectorAll('.tab-section').forEach(d => d.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            if(el) el.classList.add('active');
        }

        // --- 1. ÃœYE Ä°ÅžLEMLERÄ° ---
        async function loadPendingUsers() {
            const tbody = document.getElementById('usersBody');
            const { data } = await supabase.from('profiles').select('*').eq('is_verified', false);
            tbody.innerHTML = data.length ? '' : '<tr><td colspan="4" style="text-align:center;">Bekleyen yok.</td></tr>';
            data.forEach(u => tbody.innerHTML += `<tr><td>${u.full_name}</td><td>${u.email}</td><td>${u.department||'-'}</td><td><button class="btn btn-green" onclick="approve('${u.id}')">âœ“</button> <button class="btn btn-red" onclick="delUser('${u.id}')">âœ—</button></td></tr>`);
        }
        async function approve(id) { if(confirm('Onayla?')) { await supabase.from('profiles').update({is_verified:true}).eq('id',id); loadPendingUsers(); } }
        async function delUser(id) { if(confirm('Sil?')) { await supabase.from('profiles').delete().eq('id',id); loadPendingUsers(); } }

        // --- 2. DUYURU Ä°ÅžLEMLERÄ° ---
        async function loadAnnouncements() {
            const tbody = document.getElementById('annBody');
            const { data } = await supabase.from('announcements').select('*').order('created_at', {ascending:false});
            tbody.innerHTML = data.length ? '' : '<tr><td colspan="2">Duyuru yok.</td></tr>';
            data.forEach(a => tbody.innerHTML += `<tr><td><span style="color:${a.color}">â€¢</span> ${a.title}</td><td><button class="btn btn-red" onclick="delAnn(${a.id})">Sil</button></td></tr>`);
        }
        async function addAnnouncement() {
            const title = document.getElementById('annText').value;
            const color = document.getElementById('annColor').value;
            if(!title) return;
            await supabase.from('announcements').insert({title, color});
            document.getElementById('annText').value = ""; loadAnnouncements();
        }
        async function delAnn(id) { if(confirm('Sil?')) { await supabase.from('announcements').delete().eq('id',id); loadAnnouncements(); } }

        // --- 3. ETKÄ°NLÄ°K Ä°ÅžLEMLERÄ° (YENÄ°) ---
        async function loadEvents() {
            const tbody = document.getElementById('evtBody');
            const { data } = await supabase.from('events').select('*').order('event_date', {ascending:true});
            tbody.innerHTML = data.length ? '' : '<tr><td colspan="4">Etkinlik yok.</td></tr>';
            data.forEach(e => tbody.innerHTML += `<tr><td><b>${e.title}</b><br><small>${e.event_date}</small></td><td>${e.location}</td><td><button class="btn btn-red" onclick="delEvent(${e.id})">Sil</button></td></tr>`);
        }
        async function addEvent() {
            const title = document.getElementById('evtTitle').value;
            const loc = document.getElementById('evtLoc').value;
            const date = document.getElementById('evtDate').value;
            const time = document.getElementById('evtTime').value;
            const spk = document.getElementById('evtSpeaker').value;

            if(!title || !date) { alert("BaÅŸlÄ±k ve Tarih zorunludur."); return; }
            
            await supabase.from('events').insert({ title: title, location: loc, event_date: date, event_time: time, speaker: spk });
            alert("Etkinlik eklendi!");
            document.getElementById('evtTitle').value = "";
            loadEvents();
        }
        async function delEvent(id) { if(confirm('Sil?')) { await supabase.from('events').delete().eq('id',id); loadEvents(); } }

    </script>
</body>
</html>

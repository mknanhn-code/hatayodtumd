<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiriÅŸ - Hatay ODTÃœ MD</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* GENEL AYARLAR */
    :root { --odtu-red: #E31E24; --odtu-dark: #333333; --bg-color: #f4f4f9; --white: #ffffff; --student-color: #f39c12; --grad-color: #27ae60; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    
    body { 
        background: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%); 
        display: flex; justify-content: center; align-items: center; 
        min-height: 100vh; padding: 20px;
    }

    /* ANA KONTEYNER */
    .main-wrapper {
        background-color: var(--white); padding: 40px; border-radius: 20px; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 900px; 
        text-align: center; border-top: 6px solid var(--odtu-red); 
        min-height: 550px; display: flex; flex-direction: column; justify-content: center; position: relative;
    }

    /* 1. SEÃ‡Ä°M EKRANI STÄ°LLERÄ° */
    #selectionScreen h1 { color: var(--odtu-red); margin-bottom: 10px; }
    #selectionScreen p { color: #666; margin-bottom: 40px; }
    
    .cards-container { display: flex; gap: 30px; justify-content: center; flex-wrap: wrap; }
    
    .role-card {
        background: #fff; border: 2px solid #eee; border-radius: 15px; padding: 40px 20px;
        width: 300px; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
    }
    
    .role-card:hover { transform: translateY(-10px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    
    .role-icon { font-size: 4rem; margin-bottom: 20px; color: #ccc; transition: 0.3s; }
    .role-title { font-size: 1.5rem; font-weight: bold; color: var(--odtu-dark); margin-bottom: 10px; }
    .role-desc { font-size: 0.9rem; color: #888; }

    /* Hover Efektleri */
    .card-student:hover { border-color: var(--student-color); }
    .card-student:hover .role-icon { color: var(--student-color); }
    
    .card-grad:hover { border-color: var(--grad-color); }
    .card-grad:hover .role-icon { color: var(--grad-color); }

    /* 2. FORM EKRANI STÄ°LLERÄ° */
    #authScreen { display: none; animation: fadeIn 0.4s ease-in-out; max-width: 400px; margin: 0 auto; width: 100%; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .back-btn { 
        position: absolute; top: 30px; left: 30px; border: none; background: none; 
        font-size: 1.2rem; color: #999; cursor: pointer; transition: 0.3s;
    }
    .back-btn:hover { color: var(--odtu-dark); }

    .auth-header i { font-size: 3rem; margin-bottom: 15px; display: block; }
    .auth-header h2 { margin-bottom: 5px; }
    .auth-header p { color: #888; margin-bottom: 25px; font-size: 0.9rem; }

    /* Form ElemanlarÄ± */
    .toggle-box { display: flex; background: #f0f0f0; border-radius: 30px; padding: 5px; margin-bottom: 25px; position: relative; }
    .toggle-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; border-radius: 25px; font-weight: bold; color: #777; z-index: 1; transition: 0.3s; }
    .toggle-btn.active { color: white; }
    #btn-bg { position: absolute; top: 5px; left: 5px; width: 50%; height: calc(100% - 10px); background: var(--odtu-dark); border-radius: 25px; transition: 0.3s; }

    .input-group { position: relative; margin-bottom: 15px; }
    .input-group input { width: 100%; padding: 12px 45px; border: 1px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; font-size: 0.95rem; }
    .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }
    .input-group input:focus { border-color: var(--odtu-dark); }

    .btn-submit { width: 100%; padding: 12px; background: var(--odtu-dark); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; }
    .btn-submit:hover { opacity: 0.9; }
    .btn-submit:disabled { background: #ccc; cursor: not-allowed; }

    /* Mesaj Kutusu */
    .message-box { padding: 15px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9rem; display: none; text-align: left; line-height: 1.5; }
    .msg-warning { background: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; }
    .msg-error { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
    .msg-success { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
    .message-box a { color: inherit; text-decoration: underline; font-weight: bold; }

    /* Form GeÃ§iÅŸi */
    .form-content { display: none; }
    .form-content.active-form { display: block; animation: fadeIn 0.3s; }

    /* Mobil */
    @media (max-width: 700px) {
        .main-wrapper { padding: 20px; }
        .role-card { width: 100%; }
    }
</style>
</head>
<body>

<div class="main-wrapper">
    
    <div id="selectionScreen">
        <i class="fa-solid fa-graduation-cap" style="font-size: 3rem; color: #E31E24; margin-bottom: 10px;"></i>
        <h1>Hatay ODTÃœ MD</h1>
        <p>LÃ¼tfen giriÅŸ yapmak istediÄŸiniz portalÄ± seÃ§iniz.</p>
        
        <div class="cards-container">
            <div class="role-card card-student" onclick="selectRole('student')">
                <i class="fa-solid fa-book-open-reader role-icon"></i>
                <div class="role-title">Ã–ÄŸrenci GiriÅŸi</div>
                <div class="role-desc">Staj imkanlarÄ±, mentorluk ve Ã¶ÄŸrenci topluluÄŸu iÃ§in.</div>
            </div>
            
            <div class="role-card card-grad" onclick="selectRole('grad')">
                <i class="fa-solid fa-user-tie role-icon"></i>
                <div class="role-title">Mezun GiriÅŸi</div>
                <div class="role-desc">Profesyonel aÄŸ, iÅŸ ilanlarÄ± ve dernek faaliyetleri iÃ§in.</div>
            </div>
        </div>
    </div>

    <div id="authScreen">
        <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i> Geri</button>
        
        <div class="auth-header">
            <i id="headerIcon" class="fa-solid fa-user"></i>
            <h2 id="headerTitle">GiriÅŸ Yap</h2>
            <p id="headerDesc">HesabÄ±nÄ±za eriÅŸmek iÃ§in bilgilerinizi girin.</p>
        </div>

        <div id="systemMessage" class="message-box"></div>

        <div class="toggle-box">
            <div id="btn-bg"></div>
            <button class="toggle-btn active" onclick="switchTab('login')">GiriÅŸ Yap</button>
            <button class="toggle-btn" onclick="switchTab('register')">KayÄ±t Ol</button>
        </div>

        <form id="loginForm" class="form-content active-form">
            <div class="input-group"><i class="fa-solid fa-envelope"></i><input type="email" id="loginEmail" placeholder="E-posta Adresi" required></div>
            <div class="input-group"><i class="fa-solid fa-lock"></i><input type="password" id="loginPassword" placeholder="Åžifre" required></div>
            <button type="submit" class="btn-submit">GiriÅŸ Yap</button>
        </form>

        <form id="registerForm" class="form-content">
            <div class="input-group"><i class="fa-solid fa-user"></i><input type="text" id="regName" placeholder="Ad Soyad" required></div>
            <div class="input-group"><i class="fa-solid fa-envelope"></i><input type="email" id="regEmail" placeholder="E-posta Adresi" required></div>
            
            <div class="input-group">
                <i class="fa-solid fa-calendar-days"></i>
                <input type="number" id="regYear" placeholder="Mezuniyet YÄ±lÄ±" required>
            </div>
            
            <div class="input-group"><i class="fa-solid fa-lock"></i><input type="password" id="regPassword" placeholder="Åžifre Belirle" required></div>
            <button type="submit" class="btn-submit">KayÄ±t Ol</button>
        </form>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const supabaseUrl = 'https://hftrmiiacxgtkarsvupn.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmdHJtaWlhY3hndGthcnN2dXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODUzNzIsImV4cCI6MjA4MDM2MTM3Mn0.BgCk5xuZx6AZuxzfBHcQqg8j8BtxU9FbupDgoFecG_k';
    
    let supabase; try { supabase = window.supabase.createClient(supabaseUrl, supabaseKey); } catch(e){}

    let currentRole = ''; // 'student' veya 'grad'

    // --- EKRAN YÃ–NETÄ°MÄ° ---
    function selectRole(role) {
        currentRole = role;
        document.getElementById('selectionScreen').style.display = 'none';
        document.getElementById('authScreen').style.display = 'block';
        updateUI(role);
    }

    function goBack() {
        document.getElementById('selectionScreen').style.display = 'block';
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('systemMessage').style.display = 'none';
    }

    function updateUI(role) {
        const title = document.getElementById('headerTitle');
        const desc = document.getElementById('headerDesc');
        const icon = document.getElementById('headerIcon');
        const yearInput = document.getElementById('regYear');
        const btnBg = document.getElementById('btn-bg');
        const submits = document.querySelectorAll('.btn-submit');

        if (role === 'student') {
            title.innerText = "Ã–ÄŸrenci PortalÄ±";
            desc.innerText = "GeleceÄŸin mezunu, hoÅŸ geldin!";
            icon.className = "fa-solid fa-book-open-reader";
            icon.style.color = "#f39c12";
            yearInput.placeholder = "Tahmini Mezuniyet YÄ±lÄ± (Ã–rn: 2026)";
            
            // Renkleri Turuncu Yap
            btnBg.style.backgroundColor = "#f39c12";
            submits.forEach(btn => btn.style.backgroundColor = "#f39c12");
        } else {
            title.innerText = "Mezun PortalÄ±";
            desc.innerText = "Tekrar hoÅŸ geldiniz hocam!";
            icon.className = "fa-solid fa-user-tie";
            icon.style.color = "#27ae60";
            yearInput.placeholder = "Mezuniyet YÄ±lÄ± (Ã–rn: 2015)";
            
            // Renkleri YeÅŸil Yap
            btnBg.style.backgroundColor = "#27ae60";
            submits.forEach(btn => btn.style.backgroundColor = "#27ae60");
        }
    }

    function switchTab(tab) {
        document.getElementById('systemMessage').style.display = 'none';
        const loginForm = document.getElementById('loginForm');
        const regForm = document.getElementById('registerForm');
        const bg = document.getElementById('btn-bg');
        const btns = document.querySelectorAll('.toggle-btn');

        if (tab === 'login') {
            loginForm.classList.add('active-form'); regForm.classList.remove('active-form');
            bg.style.left = '5px'; btns[0].classList.add('active'); btns[1].classList.remove('active');
        } else {
            loginForm.classList.remove('active-form'); regForm.classList.add('active-form');
            bg.style.left = '50%'; btns[0].classList.remove('active'); btns[1].classList.add('active');
        }
    }

    function showMessage(msg, type) {
        const box = document.getElementById('systemMessage');
        box.innerHTML = msg; box.className = 'message-box ' + type; box.style.display = 'block';
    }

    // --- KAYIT ---
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'Ä°ÅŸleniyor...'; btn.disabled = true;

        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const name = document.getElementById('regName').value;
        const year = document.getElementById('regYear').value;

        try {
            const { data, error } = await supabase.auth.signUp({
                email, password, options: { data: { full_name: name } }
            });

            if (error) throw error;

            if (data.user) {
                // Profil tablosunu gÃ¼ncelle (YÄ±lÄ± ekle)
                await supabase.from('profiles').update({ grad_year: year }).eq('id', data.user.id);
            }

            showMessage(`<b>KaydÄ±nÄ±z alÄ±ndÄ±!</b> ðŸŽ‰<br>YÃ¶netici onayÄ± iÃ§in <a href="mailto:hatayodtumd@gmail.com">hatayodtumd@gmail.com</a> ile iletiÅŸime geÃ§iniz.`, "msg-warning");
            
            this.reset();
            setTimeout(() => { switchTab('login'); }, 6000);

        } catch (error) {
            showMessage("Hata: " + error.message, "msg-error");
        } finally {
            btn.innerText = originalText; btn.disabled = false;
        }
    });

    // --- GÄ°RÄ°Åž ---
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'Kontrol ediliyor...'; btn.disabled = true;

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw new Error("Bilgiler hatalÄ±.");

            const { data: profile } = await supabase.from('profiles').select('is_verified').eq('id', data.user.id).single();

            if (!profile.is_verified) {
                await supabase.auth.signOut();
                showMessage("ÃœyeliÄŸiniz henÃ¼z <b>YÃ–NETÄ°CÄ° ONAYI</b> almamÄ±ÅŸtÄ±r.", "msg-warning");
                return;
            }

            // BaÅŸarÄ±lÄ±
            showMessage("GiriÅŸ BaÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...", "msg-success");
            localStorage.setItem("kullaniciAdi", data.user.user_metadata.full_name);
            setTimeout(() => { window.location.href = "dashboard.html"; }, 1000);

        } catch (error) {
            showMessage(error.message, "msg-error");
        } finally {
            btn.innerText = originalText; btn.disabled = false;
        }
    });
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Giriş - Hatay ODTÜ MD</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* CSS STİLLERİ */
    :root { --odtu-red: #E31E24; --odtu-dark: #333333; --bg-color: #f4f4f9; --white: #ffffff; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .container { background-color: var(--white); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 420px; text-align: center; border-top: 5px solid var(--odtu-red); position: relative; overflow: hidden; }
    .header-icon { width: 50px; height: 50px; background-color: var(--odtu-red); color: var(--white); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; margin: 0 auto 1rem auto; }
    .toggle-box { display: flex; justify-content: center; margin-bottom: 2rem; background: #f0f0f0; border-radius: 30px; padding: 5px; position: relative; }
    .toggle-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; border-radius: 25px; font-weight: bold; color: #777; transition: 0.3s; z-index: 1; }
    .toggle-btn.active { color: var(--white); }
    #btn-bg { position: absolute; top: 5px; left: 5px; width: 50%; height: calc(100% - 10px); background: var(--odtu-red); border-radius: 25px; transition: 0.3s; }
    .form-box { display: none; animation: fadeIn 0.5s; }
    .form-box.active-form { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .input-group { position: relative; margin-bottom: 1rem; }
    .input-group input { width: 100%; padding: 12px 40px; border: 1px solid #ddd; border-radius: 6px; outline: none; transition: 0.3s; }
    .input-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #888; }
    .btn-submit { width: 100%; padding: 12px; background-color: var(--odtu-red); color: var(--white); border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: 0.3s; margin-top: 10px; }
    .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; }
    .message-box { padding: 10px; margin-bottom: 15px; border-radius: 5px; font-size: 0.85rem; display: none; }
    .msg-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
    .msg-error { background-color: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
</style>
</head>
<body>

<div class="container">
    <div class="header-icon"><i class="fa-solid fa-graduation-cap"></i></div>
    <h2>Hatay ODTÜ MD</h2>
    <p>Mezunlar Platformu</p>

    <div id="systemMessage" class="message-box"></div>

    <div class="toggle-box">
        <div id="btn-bg"></div>
        <button class="toggle-btn active" onclick="switchForm('login')">Giriş Yap</button>
        <button class="toggle-btn" onclick="switchForm('register')">Kayıt Ol</button>
    </div>

    <form id="loginForm" class="form-box active-form">
        <div class="input-group">
            <i class="fa-solid fa-envelope input-icon"></i>
            <input type="email" id="loginEmail" placeholder="E-posta Adresiniz" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-lock input-icon"></i>
            <input type="password" id="loginPassword" placeholder="Şifreniz" required>
        </div>
        <button type="submit" class="btn-submit">Giriş Yap</button>
    </form>

    <form id="registerForm" class="form-box">
        <div class="input-group">
            <i class="fa-solid fa-user input-icon"></i>
            <input type="text" id="regName" placeholder="Ad Soyad" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-envelope input-icon"></i>
            <input type="email" id="regEmail" placeholder="E-posta Adresiniz" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-lock input-icon"></i>
            <input type="password" id="regPassword" placeholder="Şifre Belirle" required>
        </div>
        <button type="submit" class="btn-submit">Kayıt Ol</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // --- 1. SUPABASE AYARLARI (SENİN BİLGİLERİNİ GİRDİM) ---
    const supabaseUrl = 'https://hftrmiiacxgtkarsvupn.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmdHJtaWlhY3hndGthcnN2dXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODUzNzIsImV4cCI6MjA4MDM2MTM3Mn0.BgCk5xuZx6AZuxzfBHcQqg8j8BtxU9FbupDgoFecG_k';

    let supabase;

    // --- Sayfa Tamamen Yüklendiğinde Çalışacak ---
    document.addEventListener("DOMContentLoaded", function() {
        try {
            // Supabase başlatma
            if (typeof window.supabase !== 'undefined') {
                const { createClient } = window.supabase;
                supabase = createClient(supabaseUrl, supabaseKey);
                console.log("Supabase başarıyla başlatıldı.");
            } else {
                throw new Error("Supabase kütüphanesi yüklenemedi. İnternet bağlantınızı kontrol edin.");
            }
        } catch (err) {
            alert("Bağlantı Hatası: " + err.message);
            console.error(err);
        }
    });

    // --- 2. GÖRSEL FONKSİYONLAR ---
    function switchForm(type) {
        document.getElementById('systemMessage').style.display = 'none';
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const bg = document.getElementById('btn-bg');
        const buttons = document.querySelectorAll('.toggle-btn');

        if (type === 'login') {
            loginForm.classList.add('active-form'); registerForm.classList.remove('active-form');
            bg.style.left = '5px'; buttons[0].classList.add('active'); buttons[1].classList.remove('active');
        } else {
            loginForm.classList.remove('active-form'); registerForm.classList.add('active-form');
            bg.style.left = '50%'; buttons[0].classList.remove('active'); buttons[1].classList.add('active');
        }
    }

    function showMessage(msg, type) {
        const msgBox = document.getElementById('systemMessage');
        msgBox.innerText = msg;
        msgBox.className = 'message-box ' + type;
        msgBox.style.display = 'block';
    }

    // --- 3. KAYIT OLMA İŞLEMİ ---
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!supabase) {
            alert("Sistem henüz hazır değil, lütfen sayfayı yenileyin.");
            return;
        }

        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'İşleniyor...';
        btn.disabled = true;

        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const fullName = document.getElementById('regName').value;

        try {
            // Supabase'e gönder
            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
                options: { data: { full_name: fullName } }
            });

            if (error) {
                throw error; // Hatayı yakala
            }

            console.log("Kayıt Başarılı:", data);
            showMessage("Kayıt Başarılı! Şimdi giriş yapabilirsiniz.", "msg-success");
            btn.innerText = originalText;
            btn.disabled = false;
            
            // Formu temizle ve Giriş sekmesine geç
            document.getElementById('regEmail').value = "";
            document.getElementById('regPassword').value = "";
            document.getElementById('regName').value = "";
            setTimeout(() => { switchForm('login'); }, 2000);

        } catch (error) {
            console.error("Kayıt Hatası:", error);
            showMessage("Hata: " + error.message, "msg-error");
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });

    // --- 4. GİRİŞ YAPMA İŞLEMİ ---
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!supabase) {
            alert("Sistem henüz hazır değil, lütfen sayfayı yenileyin.");
            return;
        }

        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'Kontrol ediliyor...';
        btn.disabled = true;
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });

            if (error) {
                throw error;
            }

            console.log("Giriş Başarılı:", data);
            showMessage("Giriş Başarılı! Yönlendiriliyorsunuz...", "msg-success");
            
            // İsmi hafızaya al
            const userName = data.user.user_metadata.full_name || "Üye";
            localStorage.setItem("kullaniciAdi", userName);
            
            setTimeout(() => {
                window.location.href = "dashboard.html"; 
            }, 1000);

        } catch (error) {
            console.error("Giriş Hatası:", error);
            showMessage("Giriş Başarısız: " + error.message, "msg-error");
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });
</script>

</body>
</html>

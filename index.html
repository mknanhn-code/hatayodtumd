<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiriÅŸ - Hatay ODTÃœ MD</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* CSS STÄ°LLERÄ° */
    :root { --odtu-red: #E31E24; --odtu-dark: #333333; --bg-color: #f4f4f9; --white: #ffffff; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .container { background-color: var(--white); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 420px; text-align: center; border-top: 5px solid var(--odtu-red); position: relative; overflow: hidden; }
    .header-icon { width: 50px; height: 50px; background-color: var(--odtu-red); color: var(--white); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; margin: 0 auto 1rem auto; }
    .toggle-box { display: flex; justify-content: center; margin-bottom: 2rem; background: #f0f0f0; border-radius: 30px; padding: 5px; position: relative; }
    .toggle-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; border-radius: 25px; font-weight: bold; color: #777; transition: 0.3s; z-index: 1; }
    .toggle-btn.active { color: var(--white); }
    #btn-bg { position: absolute; top: 5px; left: 5px; width: 50%; height: calc(100% - 10px); background: var(--odtu-red); border-radius: 25px; transition: 0.3s; }
    .form-box { display: none; animation: fadeIn 0.5s; }
    .form-box.active-form { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .input-group { position: relative; margin-bottom: 1rem; }
    .input-group input { width: 100%; padding: 12px 40px; border: 1px solid #ddd; border-radius: 6px; outline: none; transition: 0.3s; }
    .input-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #888; }
    .btn-submit { width: 100%; padding: 12px; background-color: var(--odtu-red); color: var(--white); border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: 0.3s; margin-top: 10px; }
    .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; }
    
    /* Mesaj Kutusu Stili */
    .message-box { padding: 15px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9rem; display: none; line-height: 1.5; text-align: left;}
    .msg-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
    .msg-error { background-color: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
    .msg-warning { background-color: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; }
    .message-box a { color: inherit; text-decoration: underline; font-weight: bold; }
</style>
</head>
<body>

<div class="container">
    <div class="header-icon"><i class="fa-solid fa-graduation-cap"></i></div>
    <h2>Hatay ODTÃœ MD</h2>
    <p>Mezunlar Platformu</p>

    <div id="systemMessage" class="message-box"></div>

    <div class="toggle-box">
        <div id="btn-bg"></div>
        <button class="toggle-btn active" onclick="switchForm('login')">GiriÅŸ Yap</button>
        <button class="toggle-btn" onclick="switchForm('register')">KayÄ±t Ol</button>
    </div>

    <form id="loginForm" class="form-box active-form">
        <div class="input-group">
            <i class="fa-solid fa-envelope input-icon"></i>
            <input type="email" id="loginEmail" placeholder="E-posta Adresiniz" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-lock input-icon"></i>
            <input type="password" id="loginPassword" placeholder="Åžifreniz" required>
        </div>
        <button type="submit" class="btn-submit">GiriÅŸ Yap</button>
    </form>

    <form id="registerForm" class="form-box">
        <div class="input-group">
            <i class="fa-solid fa-user input-icon"></i>
            <input type="text" id="regName" placeholder="Ad Soyad" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-envelope input-icon"></i>
            <input type="email" id="regEmail" placeholder="E-posta Adresiniz" required>
        </div>
        <div class="input-group">
            <i class="fa-solid fa-lock input-icon"></i>
            <input type="password" id="regPassword" placeholder="Åžifre Belirle" required>
        </div>
        <button type="submit" class="btn-submit">KayÄ±t Ol</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // --- 1. SUPABASE AYARLARI (Senin Bilgilerin) ---
    const supabaseUrl = 'https://hftrmiiacxgtkarsvupn.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmdHJtaWlhY3hndGthcnN2dXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3ODUzNzIsImV4cCI6MjA4MDM2MTM3Mn0.BgCk5xuZx6AZuxzfBHcQqg8j8BtxU9FbupDgoFecG_k';

    let supabase;

    // --- Sayfa Tamamen YÃ¼klendiÄŸinde Ã‡alÄ±ÅŸacak ---
    document.addEventListener("DOMContentLoaded", function() {
        try {
            if (typeof window.supabase !== 'undefined') {
                const { createClient } = window.supabase;
                supabase = createClient(supabaseUrl, supabaseKey);
            } else {
                throw new Error("Supabase kÃ¼tÃ¼phanesi yÃ¼klenemedi.");
            }
        } catch (err) {
            console.error(err);
        }
    });

    // --- 2. GÃ–RSEL FONKSÄ°YONLAR ---
    function switchForm(type) {
        document.getElementById('systemMessage').style.display = 'none';
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const bg = document.getElementById('btn-bg');
        const buttons = document.querySelectorAll('.toggle-btn');

        if (type === 'login') {
            loginForm.classList.add('active-form'); registerForm.classList.remove('active-form');
            bg.style.left = '5px'; buttons[0].classList.add('active'); buttons[1].classList.remove('active');
        } else {
            loginForm.classList.remove('active-form'); registerForm.classList.add('active-form');
            bg.style.left = '50%'; buttons[0].classList.remove('active'); buttons[1].classList.add('active');
        }
    }

    // HTML Ä°Ã§eriÄŸi destekleyen mesaj kutusu
    function showMessage(msg, type) {
        const msgBox = document.getElementById('systemMessage');
        msgBox.innerHTML = msg; 
        msgBox.className = 'message-box ' + type;
        msgBox.style.display = 'block';
    }

    // --- 3. KAYIT OLMA Ä°ÅžLEMÄ° ---
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!supabase) { alert("Sistem henÃ¼z hazÄ±r deÄŸil."); return; }

        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'Ä°ÅŸleniyor...';
        btn.disabled = true;

        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const fullName = document.getElementById('regName').value;

        try {
            // Supabase'e gÃ¶nder
            const { data, error } = await supabase.auth.signUp({
                email: email,
                password: password,
                options: { data: { full_name: fullName } }
            });

            if (error) throw error;

            // Ã–ZEL MESAJ BURADA
            showMessage(`
                <b>KaydÄ±nÄ±z alÄ±ndÄ±!</b> ðŸŽ‰ <br><br>
                YÃ¶netici onayÄ± sÃ¼recini hÄ±zlandÄ±rmak iÃ§in 
                <a href="mailto:hatayodtumd@gmail.com">hatayodtumd@gmail.com</a>'a mail atabilir, 
                Hatay ODTÃœ MD topluluÄŸuna hemen dahil olabilirsiniz.<br><br>
                Åžimdiden hoÅŸ geldiniz!
            `, "msg-warning");

            btn.innerText = originalText;
            btn.disabled = false;
            
            // Formu temizle ama hemen yÃ¶nlendirme yapma ki mesajÄ± okusunlar
            document.getElementById('regEmail').value = "";
            document.getElementById('regPassword').value = "";
            document.getElementById('regName').value = "";
            
            // 7 Saniye sonra giriÅŸ formuna at
            setTimeout(() => { switchForm('login'); }, 7000);

        } catch (error) {
            console.error("KayÄ±t HatasÄ±:", error);
            showMessage("Hata: " + error.message, "msg-error");
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });

    // --- 4. GÄ°RÄ°Åž YAPMA Ä°ÅžLEMÄ° (Onay KontrollÃ¼) ---
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        if (!supabase) return;

        const btn = this.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = 'Kontrol ediliyor...';
        btn.disabled = true;
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            // 1. GiriÅŸ denemesi
            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });

            if (error) throw new Error("E-posta veya ÅŸifre hatalÄ±.");

            // 2. Onay Durumu KontrolÃ¼
            const userId = data.user.id;
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('is_verified')
                .eq('id', userId)
                .single();

            if (profileError) throw profileError;

            if (!profile.is_verified) {
                await supabase.auth.signOut();
                showMessage("ÃœyeliÄŸiniz henÃ¼z <b>YÃ–NETÄ°CÄ° ONAYI</b> almamÄ±ÅŸtÄ±r. LÃ¼tfen bekleyiniz veya iletiÅŸime geÃ§iniz.", "msg-warning");
                btn.innerText = originalText;
                btn.disabled = false;
                return;
            }

            // 3. BaÅŸarÄ±lÄ±
            showMessage("GiriÅŸ BaÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...", "msg-success");
            const userName = data.user.user_metadata.full_name || "Ãœye";
            localStorage.setItem("kullaniciAdi", userName);
            
            setTimeout(() => { window.location.href = "dashboard.html"; }, 1000);

        } catch (error) {
            console.error("GiriÅŸ HatasÄ±:", error);
            await supabase.auth.signOut();
            showMessage(error.message, "msg-error");
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });
</script>

</body>
</html>
